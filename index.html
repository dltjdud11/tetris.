<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Î™®Î∞îÏùº ÌÖåÌä∏Î¶¨Ïä§ Í≤åÏûÑ (ÏµúÏ¢Ö 5Ï∞® ÏïàÏ†ïÌôî)</title>
    
    <style>
        /* CSS Ïä§ÌÉÄÏùº (Î≥ÄÎèô ÏóÜÏùå) */
        body {
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding-top: 20px;
            background-color: #333;
            font-family: Arial, sans-serif;
            color: white;
            overflow: hidden; 
            user-select: none;
            box-sizing: border-box;
        }

        .game-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            background-color: #222;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }

        #game-board {
            display: grid;
            grid-template-rows: repeat(20, 1fr); 
            grid-template-columns: repeat(10, 1fr);
            width: 300px; 
            height: 600px;
            border: 3px solid #ccc;
            background-color: #111;
        }

        .cell {
            width: 100%;
            height: 100%;
            box-sizing: border-box;
            border: 1px solid #000;
        }

        /* ÌÖåÌä∏Î°úÎØ∏ÎÖ∏ Î∏îÎ°ù ÏÉâÏÉÅ */
        .T { background-color: purple; border-color: #6a0080; }
        .L { background-color: orange; border-color: #cc6600; }
        .J { background-color: blue; border-color: #000080; }
        .S { background-color: green; border-color: #004d00; }
        .Z { background-color: red; border-color: #800000; }
        .I { background-color: cyan; border-color: #008080; }
        .O { background-color: yellow; border-color: #808000; }

        .info-panel {
            width: 300px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            font-size: 1.2em;
        }
        
        #start-button {
            padding: 10px 15px;
            font-size: 16px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        /* Î™®Î∞îÏùº Ïª®Ìä∏Î°§ Ïä§ÌÉÄÏùºÎßÅ */
        .controls {
            display: flex;
            justify-content: space-around;
            width: 100%;
            padding: 15px 0;
        }

        .controls button {
            padding: 15px 25px;
            font-size: 24px;
            background-color: #444;
            color: white;
            border: 2px solid #666;
            border-radius: 10px;
            cursor: pointer;
            touch-action: manipulation; 
            flex-grow: 1; 
            margin: 0 5px;
            min-width: 60px;
            height: 60px;
        }

        @media (max-width: 600px) {
            #game-board, .info-panel {
                width: 90vw; 
                max-width: 300px;
            }
            #game-board {
                height: calc(90vw * 2); 
                max-height: 600px;
            }
            .controls {
                width: 90vw;
                max-width: 320px;
            }
        }
    </style>
</head>
<body>
    <div class="game-wrapper">
        <div class="info-panel">
            <p>SCORE: <span id="score">0</span></p>
            <button id="start-button">START</button>
        </div>
        
        <div id="game-board">
            </div>
        
        <div class="controls">
            <button id="left">‚¨ÖÔ∏è</button>
            <button id="rotate">üîÑ</button>
            <button id="right">‚û°Ô∏è</button>
            <button id="down">‚¨áÔ∏è</button>
        </div>
    </div>
    
    <script>
        // --- Í≤åÏûÑ ÏÑ§Ï†ï ---
        const COLS = 10;
        const ROWS = 20;
        let score = 0;
        let gameBoard = []; 
        let gridState = Array(COLS * ROWS).fill(null); 
        
        let currentTetromino;
        let currentTetrominoName;
        let currentRotation = 0;
        let currentPosition = 4;
        let timerId = null;

        const boardElement = document.getElementById('game-board');
        const scoreElement = document.getElementById('score');
        const startButton = document.getElementById('start-button');
        const controls = {
            left: document.getElementById('left'),
            rotate: document.getElementById('rotate'),
            right: document.getElementById('right'),
            down: document.getElementById('down'),
        };

        const TETROMINOS = [
            [[1, COLS + 1, COLS * 2 + 1, 2], [COLS, COLS * 2, COLS * 2 + 1, COLS * 2 + 2], [1, COLS + 1, COLS * 2 + 1, COLS * 2], [COLS, COLS + 1, COLS + 2, COLS * 2 + 2]], // L
            [[1, COLS + 1, COLS * 2 + 1, 0], [COLS, COLS * 2, COLS + 1, COLS + 2], [1, COLS + 1, COLS * 2 + 1, COLS * 2 + 2], [COLS + 2, COLS * 2, COLS * 2 + 1, COLS * 2 + 2]], // J
            [[1, COLS, COLS + 1, COLS + 2], [1, COLS + 1, COLS * 2 + 1, COLS + 2], [COLS, COLS + 1, COLS + 2, COLS * 2 + 1], [1, COLS, COLS + 1, COLS * 2 + 1]], // T
            [[COLS + 1, COLS + 2, COLS * 2, COLS * 2 + 1], [0, COLS, COLS + 1, COLS * 2 + 1]], // S
            [[COLS, COLS + 1, COLS * 2 + 1, COLS * 2 + 2], [1, COLS, COLS + 1, COLS * 2]], // Z
            [[1, COLS + 1, COLS * 2 + 1, COLS * 3 + 1], [COLS, COLS + 1, COLS + 2, COLS + 3], [1, COLS + 1, COLS * 2 + 1, COLS * 3 + 1], [COLS, COLS + 1, COLS + 2, COLS + 3]], // I
            [[0, 1, COLS, COLS + 1]] // O
        ];
        const TETROMINO_NAMES = ['L', 'J', 'T', 'S', 'Z', 'I', 'O'];

        // --- Î≥¥Îìú Ï¥àÍ∏∞Ìôî ---
        function createBoard() {
            boardElement.innerHTML = '';
            gameBoard = [];
            gridState = Array(COLS * ROWS).fill(null);
            for (let i = 0; i < COLS * ROWS; i++) {
                const cell = document.createElement('div');
                cell.classList.add('cell');
                boardElement.appendChild(cell);
                gameBoard.push(cell); 
            }
        }

        // --- Î∏îÎ°ù ÏÉùÏÑ± ---
        function generateTetromino() {
            const randomIndex = Math.floor(Math.random() * TETROMINOS.length);
            currentTetromino = TETROMINOS[randomIndex];
            currentTetrominoName = TETROMINO_NAMES[randomIndex];
            currentRotation = 0;
            currentPosition = 4;

            if (checkCollision(currentPosition, currentRotation, 0)) {
                gameOver();
                return false;
            }
            draw();
            return true;
        }

        // --- Î∏îÎ°ù Í∑∏Î¶¨Í∏∞/ÏßÄÏö∞Í∏∞ ---
        function draw() {
            currentTetromino[currentRotation].forEach(index => {
                const targetIndex = currentPosition + index;
                if (gameBoard[targetIndex]) {
                    gameBoard[targetIndex].classList.add(currentTetrominoName);
                }
            });
        }

        function undraw() {
            currentTetromino[currentRotation].forEach(index => {
                const targetIndex = currentPosition + index;
                if (gameBoard[targetIndex]) {
                    gameBoard[targetIndex].classList.remove(currentTetrominoName);
                }
            });
        }

        // --- Ï∂©Îèå Í∞êÏßÄ ---
        function checkCollision(nextPosition, nextRotation, direction) {
            return currentTetromino[nextRotation].some(index => {
                const targetIndex = nextPosition + index;
                const nextCol = targetIndex % COLS;
                
                if (targetIndex >= COLS * ROWS) return true;
                if (targetIndex >= 0 && gridState[targetIndex] !== null) return true;

                const currentCol = (currentPosition + index) % COLS;

                if (direction === -1) { 
                    if (nextCol > currentCol) return true; 
                    if (nextCol === COLS - 1) return true; 
                } else if (direction === 1) { 
                    if (nextCol < currentCol) return true; 
                    if (nextCol === 0) return true; 
                }
                
                return false;
            });
        }
        
        // --- Î∏îÎ°ù Ïù¥Îèô/ÌöåÏ†Ñ Î°úÏßÅ ---
        function move(direction) {
            if (!timerId) return;
            undraw();
            let newPosition = currentPosition + direction;

            if (!checkCollision(newPosition, currentRotation, direction)) {
                currentPosition = newPosition;
            }
            draw();
        }

        function rotate() {
            if (!timerId) return;
            undraw();
            const nextRotation = (currentRotation + 1) % currentTetromino.length;

            if (!checkCollision(currentPosition, nextRotation, 0)) {
                currentRotation = nextRotation;
            }
            draw();
        }

        // --- Î∏îÎ°ù ÌïòÍ∞ï Î°úÏßÅ (ÌïµÏã¨ ÏàòÏ†ï Î∂ÄÎ∂Ñ) ---
        function fall() {
            undraw(); 
            let newPosition = currentPosition + COLS;

            if (checkCollision(newPosition, currentRotation, COLS)) {
                // Ï∂©Îèå: Î∏îÎ°ùÏùÑ Í≥†Ï†ï (Freeze)Ìï©ÎãàÎã§.
                freeze(); 
                
                // Í≥†Ï†ï ÌõÑ, Ï§ÑÏùÑ Í≤ÄÏÇ¨ÌïòÍ≥† ÏÉÅÌÉú Î∞∞Ïó¥(gridState)ÏùÑ Î≥ÄÍ≤ΩÌï©ÎãàÎã§.
                checkLines();
                
                // gridState Î≥ÄÍ≤Ω ÏÇ¨Ìï≠ÏùÑ DOMÏóê Ï¶âÏãú Î∞òÏòÅÌïòÏó¨ Î∏îÎ°ù ÏÇ¨ÎùºÏßêÏùÑ Î∞©ÏßÄÌï©ÎãàÎã§.
                updateDOM(); 
                
                // ÏÉà Î∏îÎ°ùÏùÑ ÏÉùÏÑ±Ìï©ÎãàÎã§.
                generateTetromino(); 
                
            } else {
                // ÎØ∏Ï∂©Îèå: ÏúÑÏπòÎ•º ÏóÖÎç∞Ïù¥Ìä∏ÌïòÍ≥† Îã§Ïãú Í∑∏Î¶ΩÎãàÎã§.
                currentPosition = newPosition;
                draw();
            }
        }

        // --- Î∏îÎ°ù Í≥†Ï†ï ---
        function freeze() {
            currentTetromino[currentRotation].forEach(index => {
                const targetIndex = currentPosition + index;
                if (targetIndex >= 0 && targetIndex < COLS * ROWS) {
                    // gridStateÏóê ÏòÅÍµ¨Ï†ÅÏúºÎ°ú Î∏îÎ°ù Ïù¥Î¶ÑÏùÑ Ï†ÄÏû•Ìï©ÎãàÎã§.
                    gridState[targetIndex] = currentTetrominoName;
                }
            });
        }

        // --- Ï§Ñ Ï†úÍ±∞ Î∞è DOM ÏóÖÎç∞Ïù¥Ìä∏ ---
        function checkLines() {
            let linesCleared = 0;
            
            for (let i = ROWS - 1; i >= 0; i--) {
                const rowStart = i * COLS;
                const rowState = gridState.slice(rowStart, rowStart + COLS);
                
                const isFull = rowState.every(cellState => cellState !== null);
                
                if (isFull) {
                    linesCleared++;
                    
                    gridState.splice(rowStart, COLS);
                    const emptyRow = Array(COLS).fill(null);
                    gridState.unshift(...emptyRow);
                }
            }
            
            if (linesCleared > 0) {
                score += linesCleared * 100;
                scoreElement.textContent = score;
            }
        }

        function updateDOM() {
            for (let i = 0; i < COLS * ROWS; i++) {
                gameBoard[i].className = 'cell'; 
                if (gridState[i] !== null) {
                    gameBoard[i].classList.add(gridState[i]);
                }
            }
        }

        // --- Í≤åÏûÑ Ïò§Î≤Ñ ---
        function gameOver() {
            clearInterval(timerId);
            timerId = null;
            startButton.textContent = 'RESTART';
            alert(`Game Over! Score: ${score}`);
        }

        // --- Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà (Î≤ÑÌäº ÏûëÎèô Ïò§Î•ò ÏàòÏ†ï) ---

        // PC ÌÇ§Î≥¥Îìú Ïù¥Î≤§Ìä∏
        document.addEventListener('keydown', (e) => {
            if (!timerId) return; 

            if (e.key === 'ArrowLeft') move(-1);
            else if (e.key === 'ArrowRight') move(1);
            else if (e.key === 'ArrowDown') fall();
            else if (e.key === 'ArrowUp') rotate();
        });

        // **PC ÎßàÏö∞Ïä§ ÌÅ¥Î¶≠ Î∞è Î™®Î∞îÏùº ÌÑ∞Ïπò Ïù¥Î≤§Ìä∏Î•º ÌÜµÌï© Ï≤òÎ¶¨**
        function handleControlAction(e, action) {
            e.preventDefault(); // ÌÑ∞Ïπò/ÎßàÏö∞Ïä§ ÌÅ¥Î¶≠ Ïãú Î∏åÎùºÏö∞Ï†Ä Í∏∞Î≥∏ ÎèôÏûë Î∞©ÏßÄ
            if (!timerId) return;

            if (action === 'left') move(-1);
            else if (action === 'right') move(1);
            else if (action === 'down') fall();
            else if (action === 'rotate') rotate();
        }

        // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Îì±Î°ù: touchstart (Î™®Î∞îÏùº)ÏôÄ click (PC ÎßàÏö∞Ïä§) Î™®Îëê Îì±Î°ù
        controls.left.addEventListener('touchstart', (e) => handleControlAction(e, 'left'));
        controls.right.addEventListener('touchstart', (e) => handleControlAction(e, 'right'));
        controls.down.addEventListener('touchstart', (e) => handleControlAction(e, 'down'));
        controls.rotate.addEventListener('touchstart', (e) => handleControlAction(e, 'rotate'));
        
        controls.left.addEventListener('click', (e) => handleControlAction(e, 'left'));
        controls.right.addEventListener('click', (e) => handleControlAction(e, 'right'));
        controls.down.addEventListener('click', (e) => handleControlAction(e, 'down'));
        controls.rotate.addEventListener('click', (e) => handleControlAction(e, 'rotate'));


        // Í≤åÏûÑ ÏãúÏûë/ÏùºÏãúÏ†ïÏßÄ Î≤ÑÌäº
        startButton.addEventListener('click', () => {
            if (timerId) {
                // ÏùºÏãú Ï†ïÏßÄ
                clearInterval(timerId);
                timerId = null;
                startButton.textContent = 'RESUME';
            } else {
                if (startButton.textContent === 'START' || startButton.textContent === 'RESTART') {
                    // ÏÉà Í≤åÏûÑ ÏãúÏûë
                    createBoard(); 
                    score = 0;
                    scoreElement.textContent = score;
                    generateTetromino();
                }
                
                // Í≤åÏûÑ Ïû¨Í∞ú ÎòêÎäî ÏãúÏûë
                timerId = setInterval(fall, 800); 
                startButton.textContent = 'PAUSE';
            }
        });

        // --- Ï¥àÍ∏∞ Ïã§Ìñâ ---
        createBoard();
    </script>
</body>
</html>
